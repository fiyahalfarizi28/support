<!-- <div class="row mt-3">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <b>PERHITUNGAN RFM</b>
            </div>

            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-warning">
                            <div class="card-body">
                                <h1><?php echo $jumlah_queue ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-list"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">On Queued</span>
                            </i>
                        </div>
                    </div>
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-primary">
                            <div class="card-body">
                                <h1><?php echo $jumlah_approve ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-check-double"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">Approved</span>
                            </i>
                        </div>
                    </div>
                
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-dark">
                            <div class="card-body">
                                <h1><?php echo $jumlah_progress ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">On Progress</span>
                            </i>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-success">
                            <div class="card-body">
                                <h1><?php echo $jumlah_done ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-thumbs-up"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">Done</span>
                            </i>
                        </div>
                    </div>
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-danger">
                            <div class="card-body">
                                <h1><?php echo $jumlah_reject ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-ban"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">Reject</span>
                            </i>
                        </div>
                    </div>
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-info">
                            <div class="card-body">
                                <h1><?php echo $jumlah_rfm ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">Total RFM</span>
                            </i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <b>PERHITUNGAN RFP</b>
            </div>

            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-warning">
                            <div class="card-body">
                                <h1><?php echo $jumlah_queue_rfp ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-list"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">On Queued</span>
                            </i>
                        </div>
                    </div>
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-primary">
                            <div class="card-body">
                                <h1><?php echo $jumlah_approve_rfp ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-check-double"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">Approved</span>
                            </i>
                        </div>
                    </div>
                
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-dark">
                            <div class="card-body">
                                <h1><?php echo $jumlah_progress_rfp ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">On Progress</span>
                            </i>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-success">
                            <div class="card-body">
                                <h1><?php echo $jumlah_done_rfp ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-thumbs-up"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">Done</span>
                            </i>
                        </div>
                    </div>
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-danger">
                            <div class="card-body">
                                <h1><?php echo $jumlah_reject_rfp ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-ban"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">Reject</span>
                            </i>
                        </div>
                    </div>
                    <div class="col-md-4 p-1">
                        <div class="card text-white bg-info">
                            <div class="card-body">
                                <h1><?php echo $jumlah_rfp ?></h1>
                                <div class="card-body-icon">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            <i class="card-footer text-white clearfix small">
                            <span class="float-left">Total RFP</span>
                            </i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> -->

<div class="card mb-3" id="table" style="margin-top: 15px">
    <div class="card-header" >
        <b>DAILY ACTIVITY DEPARTMENT IT</b>
    </div>
    <div class="card-body">
    <!-- table table-bordered table-hover -->
        <table class="colapse-table res3"  width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th style="text-align: center">#</th>
                    <th>HARI</th>
                    <th>TANGGAL</th>
					<th>WAKTU</th>
					<th>PROJECT</th>
					<th>TASK</th>
					<th>RFM</th>
                    <th>STATUS</th>
                    <th>KETERANGAN</th>
                    <th>PIC</th>
                </tr>
            </thead>
            <tbody>
                <?php 
                    $ITList = $this->db->get(TB_USER)->result();
                    $projectList = $this->db->get(TB_PROJECT)->result();
                    $taskList = $this->db->get(TB_TASK)->result();
                    $rfmList = $this->db->get(TB_DETAIL)->result();
                ?>

                <?php foreach($ITList as $r): ?>
                    
                    <?php 
                        $this->db->where('user_id', $r->user_id);
                        $this->db->where('tanggal', date('Y-m-d'));
                        $this->db->order_by('last_update DESC');
                        $specificDailyActivity = $this->db->get(TB_DAILY_ACTIVITY)->result();
                    ?>
                    
                    <?php if (count($specificDailyActivity) > 0) { ?>
                        <?php foreach($specificDailyActivity as $row): ?>
                            <?php if (array_search($row, $specificDailyActivity) == 0) {?>
                                <tr>
                                    <td style="text-align: center"><i data-toggle="collapse" data-target=<?php echo "#".$r->user_id?> style=" color: #28a745; background-color: #f4fbff" class="fa fa-plus-circle" aria-hidden="true"></i></td>
                                    <td>
                                        <?php
                                            $hari = date('l',strtotime($row->tanggal));
                                            switch($hari){
                                                case 'Sunday':
                                                    $hari = "Minggu";
                                                break;
                                        
                                                case 'Monday':			
                                                    $hari = "Senin";
                                                break;
                                        
                                                case 'Tuesday':
                                                    $hari = "Selasa";
                                                break;
                                        
                                                case 'Wednesday':
                                                    $hari = "Rabu";
                                                break;
                                        
                                                case 'Thursday':
                                                    $hari = "Kamis";
                                                break;
                                        
                                                case 'Friday':
                                                    $hari = "Jumat";
                                                break;
                                        
                                                case 'Saturday':
                                                    $hari = "Sabtu";
                                                break;
                                                
                                                default:
                                                    $hari= "Tidak di ketahui";		
                                                break;
                                            }
                                            echo $hari;
                                        ?>
                                    </td>
                                    <td><?php echo date("d-m-Y",strtotime( $row->tanggal)) ?></td>
                                    <td><?php echo date("H:i",strtotime( $row->last_update)) ?></td>
                                    <td>
                                        <?php 
                                            // $data = json_encode($projectList->result());
                                            // echo "<script>console.log($data);</script>";
                                            $tableDataProjectName = null;
                                            if (!empty($row->project_id))
                                            {
                                                foreach($projectList as $rowProject):
                                                    if ($row->project_id == $rowProject->id) {
                                                        $tableDataProjectName = $rowProject->project_name;
                                                        break;
                                                    }
                                                endforeach;
                                            }
                                            else {
                                                $tableDataProjectName = "-";
                                            }
                                            echo $tableDataProjectName;
                                        ?>
                                    </td>
                                    <td>
                                        <?php $tableTaskName = null;
                                            if (!empty($row->task_id))
                                            {
                                                foreach($taskList as $rowTask):
                                                    if ($row->task_id == $rowTask->id) {
                                                        $tableTaskName = $rowTask->task_name;
                                                        break;
                                                    }
                                                endforeach;
                                            }
                                            else {
                                                $tableTaskName = "-";
                                            }
                                            echo $tableTaskName;
                                        ?>
                                    </td>            
                                    <td>
                                        <?php $tableDataNoRFM = null;
                                            if (!empty($row->rfm_id))
                                            {
                                                foreach($rfmList as $rowRfm):
                                                    if ($row->rfm_id == $rowRfm->id) {
                                                        $tableDataNoRFM = $rowRfm->no_rfm;
                                                        break;
                                                    }
                                                endforeach;
                                            }
                                            else {
                                                $tableDataNoRFM = "-";
                                            }
                                            echo $tableDataNoRFM;
                                        ?>
                                    </td>
                                    <td><?php echo $row->status ?></td>
                                    <td><?php echo $row->keterangan ?></td>
                                    <td><?php echo $r->nama ?></td>
                                </tr>
                            <?php } ?>
                        <?php endforeach ?>
                        <tr id=<?php echo $r->user_id?> class="collapse">
                            <td colspan="10">
                                <p>
                                    <table style="width: 100%">
                                    <thead>
                                        <tr>
                                            <th>HARI</th>
                                            <th>TANGGAL</th>
                                            <th>WAKTU</th>
                                            <th>PROJECT</th>
                                            <th>TASK</th>
                                            <th>RFM</th>
                                            <th>STATUS</th>
                                            <th>KETERANGAN</th>
                                        </tr>
                                    </thead>
                                        <?php foreach($specificDailyActivity as $row): ?>
                                            <?php if (array_search($row, $specificDailyActivity) !== 0) {?>
                                                
                                                <tr>
                                                    <td>
                                                        <?php
                                                            $hari = date('l',strtotime($row->tanggal));
                                                            switch($hari){
                                                                case 'Sunday':
                                                                    $hari = "Minggu";
                                                                break;
                                                        
                                                                case 'Monday':			
                                                                    $hari = "Senin";
                                                                break;
                                                        
                                                                case 'Tuesday':
                                                                    $hari = "Selasa";
                                                                break;
                                                        
                                                                case 'Wednesday':
                                                                    $hari = "Rabu";
                                                                break;
                                                        
                                                                case 'Thursday':
                                                                    $hari = "Kamis";
                                                                break;
                                                        
                                                                case 'Friday':
                                                                    $hari = "Jumat";
                                                                break;
                                                        
                                                                case 'Saturday':
                                                                    $hari = "Sabtu";
                                                                break;
                                                                
                                                                default:
                                                                    $hari= "Tidak di ketahui";		
                                                                break;
                                                            }
                                                            echo $hari;
                                                        ?>
                                                    </td>
                                                    <td><?php echo date("d-m-Y",strtotime( $row->tanggal)) ?></td>
                                                    <td><?php echo date("H:i",strtotime( $row->last_update)) ?></td>
                                                    <td>
                                                        <?php 
                                                            // $data = json_encode($projectList->result());
                                                            // echo "<script>console.log($data);</script>";
                                                            $tableDataProjectName = null;
                                                            if (!empty($row->project_id))
                                                            {
                                                                foreach($projectList as $rowProject):
                                                                    if ($row->project_id == $rowProject->id) {
                                                                        $tableDataProjectName = $rowProject->project_name;
                                                                        break;
                                                                    }
                                                                endforeach;
                                                            }
                                                            else {
                                                                $tableDataProjectName = "-";
                                                            }
                                                            echo $tableDataProjectName;
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php $tableTaskName = null;
                                                            if (!empty($row->task_id))
                                                            {
                                                                foreach($taskList as $rowTask):
                                                                    if ($row->task_id == $rowTask->id) {
                                                                        $tableTaskName = $rowTask->task_name;
                                                                        break;
                                                                    }
                                                                endforeach;
                                                            }
                                                            else {
                                                                $tableTaskName = "-";
                                                            }
                                                            echo $tableTaskName;
                                                        ?>
                                                    </td>
                                                    
                                                    <td>
                                                        <?php $tableDataNoRFM = null;
                                                            if (!empty($row->rfm_id))
                                                            {   
                                                                foreach($rfmList as $rowRfm):
                                                                    if ($row->rfm_id == $rowRfm->id) {
                                                                        $tableDataNoRFM = $rowRfm->no_rfm;
                                                                        break;
                                                                    }
                                                                endforeach;
                                                            }
                                                            else {
                                                                $tableDataNoRFM = "-";
                                                            }
                                                            echo $tableDataNoRFM;
                                                        ?>
                                                    </td>
                                                    <td><?php echo $row->status ?></td>
                                                    <td><?php echo $row->keterangan ?></td>
                                                </tr>
                                            <?php } ?>
                                        <?php endforeach ?>
                                    </table>
                                </p>
                            </td>
                        </tr>
                    <?php } ?>
                <?php endforeach ?>
            </tbody>        
        </table>
    </div>
</div>

<div class="card mb-3" id="table" style="margin-top: 15px">
    <div class="card-header" >
        <b>PROGRESS PROJECT</b>
    </div>
    <div class="card-body">
    <!-- table table-bordered table-hover -->
        <table class="colapse-table res3"  width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th style="text-align: center">#</th>
                    <th>NAMA PROJECT</th>
                    <th>STATUS</th>
                </tr>
            </thead>

            <tbody>
                <?php foreach($filteredProjectList as $r): ?>
                    
                    <?php 
                        $this->db->where('project_id', $r->id);
                        $this->db->order_by('last_update DESC');
                        $specificTask = $this->db->get(TB_TASK)->result();
                    ?>
                    
                    <tr>
                        <td style="text-align: center"><i data-toggle="collapse" data-target=<?php echo "#".$r->id?> style=" color: #28a745; background-color: #f4fbff" class="fa fa-plus-circle" aria-hidden="true"></i></td>
                        <td><?php echo $r->project_name?></td>
                        <td>
                            <?php echo STT_ON_PROGRESS?>
                        </td>
                    </tr>

                    <tr id=<?php echo $r->id?> class="collapse">
                            <td colspan="3">
                                <p>
                                    <table style="width: 100%">
                                        <thead>
                                            <tr>
                                                <th>NAMA TASK</th>
                                                <th>TANGGAL DIBUAT</th>
                                                <th>UPDATE TERAKHIR</th>
                                                <th>STATUS</th>
                                                <th>PIC</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <?php foreach($specificTask as $row): ?>
                                                <tr>
                                                    <td><?php echo $row->task_name?></td>
                                                    <td><?php echo date("d-m-Y",strtotime( $row->create_date)) ?></td>
                                                    <td><?php echo date("d-m-Y H:i",strtotime( $row->last_update)) ?></td>
                                                    <td><?php echo $row->status?></td>
                                                    <td>
                                                        <?php 
                                                            $this->db->where('user_id', $row->assign_to);
                                                            echo $this->db->get(TB_USER)->row()->nama;
                                                        ?>
                                                    </td>
                                                </tr>
                                            <?php endforeach ?>
                                        </tbody>
                                    </table>
                                </p>
                            </td>
                        </tr>

                <?php endforeach ?>
            </tbody>

        </table>
    </div>
</div>

<!-- <div class="card">
	<div class="card-header">
		TIMELINE PROJECT IT
	</div>
	<div class="card-body">
		>> <a href="upload/IT PROJECT 2020.pdf" target="_blank">IT PROJECT 2020.pdf</a>
	</div>
</div> -->

<?php
    $tb_detail = TB_DETAIL;
    $Q = "SELECT DISTINCT MONTH(`request_date`) AS bulan FROM `rfm_new_detail` WHERE YEAR(`request_date`) BETWEEN '2019' AND YEAR(CURDATE()) ORDER BY MONTH(`request_date`) ASC";
    $query = $this->db->query($Q)->result();
    
    $Q = "SELECT DISTINCT YEAR(`request_date`) AS tahun 
            FROM $tb_detail";
    $queryyear = $this->db->query($Q)->result();
    
    $post_month = $this->input->post('month');
    $post_year = $this->input->post('year');
    if($post_month==1)
    {
        $bulan = "Januari";
    }
    elseif($post_month==2)
    {
        $bulan = "Februari";
    }
    elseif($post_month==3)
    {
        $bulan = "Maret";
    }
    elseif($post_month==4)
    {
        $bulan = "April";
    }
    elseif($post_month==5)
    {
        $bulan = "Mei";
    }
    elseif($post_month==6)
    {
        $bulan = "Juni";
    }
    elseif($post_month==7)
    {
        $bulan = "Juli";
    }
    elseif($post_month==8)
    {
        $bulan = "Agustus";
    }
    elseif($post_month==9)
    {
        $bulan = "September";
    }
    elseif($post_month==10)
    {
        $bulan = "Oktober";
    }
    elseif($post_month==11)
    {
        $bulan = "November";
    }
    elseif($post_month==12)
    {
        $bulan = "Desember";
    }

    if(empty($post_month))
    {
        $text_bulan = "Bulan";
        $val_bulan = "";
    }
    else
    {
        $text_bulan = $bulan;
        $val_bulan = $post_month;
    }

    if(empty($post_year))
    {
        $text_tahun = "Tahun";
        $val_tahun = date('Y');
    }
    else
    {
        $text_tahun = $post_year;
        $val_tahun = $post_year;
    }

    //CHART==================================
    echo "
        <div class='row mt-3'>
            <div class='col-md-12'>
                <form action=" . $_SERVER['PHP_SELF'] . " method='POST'>
                    <div class='row'>
                        <div class='col-md-3'>
                            <select name='monthAwal' id='monthAwal' class='form-control'>
                                <option value='$val_bulan'>$text_bulan</option>
    ";
                            foreach($query as $row):
                                if($row->bulan==01)
                                {
                                    $bulan = "Januari";
                                }
                                elseif($row->bulan==02)
                                {
                                    $bulan = "Februari";
                                }
                                elseif($row->bulan==03)
                                {
                                    $bulan = "Maret";
                                }
                                elseif($row->bulan==04)
                                {
                                    $bulan = "April";
                                }
                                elseif($row->bulan==05)
                                {
                                    $bulan = "Mei";
                                }
                                elseif($row->bulan==06)
                                {
                                    $bulan = "Juni";
                                }
                                elseif($row->bulan==07)
                                {
                                    $bulan = "Juli";
                                }
                                elseif($row->bulan=='08')
                                {
                                    $bulan = "Agustus";
                                }
                                elseif($row->bulan=='09')
                                {
                                    $bulan = "September";
                                }
                                elseif($row->bulan==10)
                                {
                                    $bulan = "Oktober";
                                }
                                elseif($row->bulan==11)
                                {
                                    $bulan = "November";
                                }
                                elseif($row->bulan==12)
                                {
                                    $bulan = "Desember";
                                }
    echo "
                                <option value='$row->bulan'>$bulan</option>
    ";
                            endforeach;
    echo "
                            </select>
                        </div>
                        <div class='col-md-3'>
                            <select name='monthAkhir' id='monthAkhir' class='form-control'>
                            </select>
                        </div>
                        <div class='col-md-4'>
                            <select name='year' id='year' class='form-control'>
                                <option value='$val_tahun'>$text_tahun</option>
                                ";
                            foreach($queryyear as $row):
    echo "
                                <option value='$row->tahun'>$row->tahun</option>
    ";
                            endforeach;
    echo "
                            </select>
                        </div>
                        <div class='col-md-2'>
                        <button name='btnSearch' type='submit' id='btnSearch' class='btn btn-primary btn-block' >CARI</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    ";
?>

<script src="<?php echo base_url('assets/js/chart/Chart.bundle.js') ?>"></script>

<div class="row mt-3">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <b>PRESENTASE APLIKASI</b>
            </div>
            <div class="card-body">
                <canvas id="myChart1"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <b>PERSENTASE KESALAHAN</b>
            </div>
            <div class="card-body">
                <canvas id="myChart2"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    <?php
        $applicationList = $this->db->get(TB_PROJECT)->result();
        $problemTypeList = $this->db->get(TB_PROBLEM_TYPE)->result();
        $rfmList = $this->db->get(TB_DETAIL)->result();
    ?>

    var ctx_ = document.getElementById("myChart1").getContext("2d");
    var data_ = {
        labels: [
            <?php
                foreach($applicationList as $r):
                    $data = array();
                    $data = $r->project_name;
                    echo json_encode($data).",";
                endforeach;
            ?>
        ],
        datasets:
        [{
            data: [
                <?php
                    foreach($applicationList as $r):
                        $data = array();
                        $counter = 0;
                        foreach($rfmList as $eachrfm):
                            if ($eachrfm->project_id == $r->id) {
                                $counter += 1;
                            }
                        endforeach;
                        // $divider = count($rfmList);
                        // $data = $counter / $divider * 100;
                        $data = $counter;
                        echo json_encode($data).",";
                    endforeach;
                ?>
            ],
            backgroundColor: [
                "rgb(244,226,226)",
                "rgb(226,240,196)",
                "rgb(255,231,155)",
                "rgb(194,239,233)",
                "rgb(233,213,190)",
                "rgb(254,229,189)",
                "rgb(233,210,225)",
                "rgb(240,180,212)",
                "rgb(200,230,200)",
                "rgb(182,184,181)",
                "rgb(243,204,111)",
                "rgb(210,220,226)",
                "rgb(179,221,209)",
                "rgb(207,235,248)",
                "rgb(247,185,147)",
                "rgb(239,228,172)",
                "rgb(246,207,200)",
                "rgb(232,150,148)",
                "rgb(254,231,218)",
                "rgb(255,203,134)",
                "rgb(232,229,194)",
                ],
                hoverBackgroundColor: 'rgb(187,185,190)',
                hoverBorderColor: 'rgb(0, 0, 0, 1)',
        }]
    };
    var myBarChartApplication = new Chart(ctx_, {
        type: 'pie',
        data: data_,
        options: {
            legend: {
                display: false
            },
            responsive: true,
            title:{
                display:true,
                text:'Application Chart'
            },
            tooltips: {
                callbacks: {
                    label: function(tooltipItem, data) {
                    var dataLabel = data.labels[tooltipItem.index];
                    var value = `: ${data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index]} | ` + (data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index] / <?php echo count($rfmList)?> * 100).toLocaleString()+'%';
                        // $divider = count($rfmList);
                        // $data = $counter / $divider * 100;
                    if (Chart.helpers.isArray(dataLabel)) {
                        dataLabel = dataLabel.slice();
                        dataLabel[0] += value;
                    } else {
                        dataLabel += value;
                    }
                    return dataLabel;
                    }
                }
            }
        }
    });


//==================================================

    var ctx_ = document.getElementById("myChart2").getContext("2d");
    var data_ = {
        labels: [
            <?php
                foreach($problemTypeList as $r):
                    $data = array();
                    $data = $r->problem_type;
                    echo json_encode($data).",";
                endforeach;
            ?>
        ],
        datasets:
        [{
            data: [
                <?php
                    foreach($problemTypeList as $r):
                        $data = array();
                        $counter = 0;
                        foreach($rfmList as $eachrfm):
                            if ($eachrfm->problem_type == $r->id) {
                                $counter += 1;
                            }
                        endforeach;
                        // $divider = count($rfmList);
                        // $data = $counter / $divider * 100;
                        $data = $counter;
                        echo json_encode($data).",";
                    endforeach;
                ?>
            ],
            backgroundColor: [
                "rgb(244,226,226)",
                "rgb(226,240,196)",
                "rgb(255,231,155)",
                "rgb(194,239,233)",
                "rgb(233,213,190)",
                "rgb(254,229,189)",
                "rgb(233,210,225)",
                "rgb(240,180,212)",
                "rgb(200,230,200)",
                "rgb(182,184,181)",
                "rgb(243,204,111)",
                "rgb(210,220,226)",
                "rgb(179,221,209)",
                "rgb(207,235,248)",
                "rgb(247,185,147)",
                "rgb(239,228,172)",
                "rgb(246,207,200)",
                "rgb(232,150,148)",
                "rgb(254,231,218)",
                "rgb(255,203,134)",
                "rgb(232,229,194)",
                ],
                hoverBackgroundColor: 'rgb(187,185,190)',
                hoverBorderColor: 'rgb(0, 0, 0, 1)',
        }]
    };
    var myBarChartProblemType = new Chart(ctx_, {
        type: 'pie',
        data: data_,
        options: {
            legend: {
                display: false
            },
            responsive: true,
            title:{
                display:true,
                text:'Problem Type Chart'
            },
            tooltips: {
                callbacks: {
                    label: function(tooltipItem, data) {
                    var dataLabel = data.labels[tooltipItem.index];
                    var value = `: ${data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index]} | ` + (data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index] / <?php echo count($rfmList)?> * 100).toLocaleString()+'%';

                    if (Chart.helpers.isArray(dataLabel)) {
                        dataLabel = dataLabel.slice();
                        dataLabel[0] += value;
                    } else {
                        dataLabel += value;
                    }

                    // return the text to display on the tooltip
                    return dataLabel;
                    }
                }
            }
        }
    });

//==================================================

    document.getElementById("monthAwal").addEventListener("change", function(){
        var e = document.getElementById("monthAwal");
        document.getElementById("monthAkhir").innerHTML = "";

        function getBulan(angka) {
            var monthText;
            switch (angka) {
                case 1:
                    monthText = 'Januari' 
                    break;
                case 2:
                    monthText = 'Februari' 
                    break;
                case 3:
                    monthText = 'Maret' 
                    break;
                case 4:
                    monthText = 'April' 
                    break;
                case 5:
                    monthText = 'Mei' 
                    break;
                case 6:
                    monthText = 'Juni' 
                    break;
                case 7:
                    monthText = 'Juli' 
                    break;
                case 8:
                    monthText = 'Agustus' 
                    break;
                case 9:
                    monthText = 'September' 
                    break;
                case 10:
                    monthText = 'Oktober' 
                    break;
                case 11:
                    monthText = 'November' 
                    break;
                case 12:
                    monthText = 'Desember' 
                    break;
            }
            return monthText;
        }

        for (var i= Number(e.options[e.selectedIndex].value); i<=12; i++) {
            if (i > 0) {
                document.getElementById("monthAkhir").innerHTML = document.getElementById("monthAkhir").innerHTML + `<option value='${i}'>${getBulan(i)}</option>`;
            }
        }
        
    });

    document.getElementById("btnSearch").addEventListener("click", function(e) {
        e.preventDefault();
        var monthAwal = document.getElementById("monthAwal");
        var monthAkhir = document.getElementById("monthAkhir");  

        if (monthAwal.options[monthAwal.selectedIndex].value == "" || monthAkhir.options[monthAkhir.selectedIndex].value == "") {
            alert('Bulan awal atau bulan akhir tidak boleh kosong!')
        } else {
            var startDate = `${year.options[year.selectedIndex].value}-${monthAwal.options[monthAwal.selectedIndex].value}-01`
            var endDate = `${year.options[year.selectedIndex].value}-${monthAwal.options[monthAwal.selectedIndex].value == monthAkhir.options[monthAkhir.selectedIndex].value ? Number(monthAkhir.options[monthAkhir.selectedIndex].value)+2 : monthAkhir.options[monthAkhir.selectedIndex].value}-01`

            console.log(startDate);
            console.log(endDate);

            <?php 
                    
                // $this->db->where('request_date >=', );
                // $this->db->where('request_date <=', "");
                // $filteredRFMList = $this->db->get(TB_DETAIL)->result();

                // echo "console.log(". json_encode($_POST['monthAwal']) .")";
            ?>

        }
        console.log('kepencet tu wa ga')
    });
</script>

<div class="row pt-3">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header"><b>REQUEST BERDASARKAN KANTOR</b></div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered" width="100%" id="dt_dashboard">
                        <thead class="bg-primary text-light">
                            <tr>
                                <!-- <th>KODE KANTOR</th> -->
                                <th>NAMA KANTOR</th>
                                <th>JUMLAH REQUEST</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php 
                                $Q = 'SELECT kode_kantor, COUNT(*) as total_by_kk
                                FROM ticket_support.rfm_new_detail
                                GROUP BY kode_kantor';
                                $rfmGrouped = $this->db->query($Q)->result();
                                
                                foreach($rfmGrouped as $r): 
                            ?>
                                <tr>
                                    <!-- <td style="text-align: left"><?php echo $r->kode_kantor ?></td> -->
                                    <td>
                                        <?php 
                                            $this->db->where('kode_kantor', $r->kode_kantor);
                                            echo $this->db->get(TB_KODE_KANTOR)->row()->nama_kantor;
                                        ?>
                                    </td>
                                    <td style="text-align: right"><?php echo $r->total_by_kk ?></td>
                                </tr>
                            <?php endforeach ?>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td><b>JUMLAH</b></td>
                                <td style="text-align: right"><?php echo "<b>$total_semua</b>" ?></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header"><b>REQUEST BERDASARKAN DIVISI</b></div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered" width="100%" id="dt_dashboard">
                    <thead class="bg-primary text-light">
                            <tr>
                                <th>DIVISI</th>
                                <th>JUMLAH REQUEST</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php 
                               $divisi = 'SELECT dpm_online.user.divisi_id as divisi_id, COUNT(*) as total_by_div
                                FROM ticket_support.rfm_new_detail
                                INNER JOIN dpm_online.user
                                ON ticket_support.rfm_new_detail.request_by = dpm_online.user.user_id
                                GROUP BY dpm_online.user.divisi_id';
                                $rfmDivisi = $this->db->query($divisi)->result();
                                
                                foreach($rfmDivisi as $r): 
                            ?>
                                <tr>
                                    <td>
                                        <?php 
                                            echo $r->divisi_id;
                                        ?>
                                    </td>
                                    <td style="text-align: right"><?php echo $r->total_by_div ?></td>
                                </tr>
                            <?php endforeach ?>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td><b>JUMLAH</b></td>
                                <td style="text-align: right"><?php echo "<b>$total_semua</b>" ?></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

                
<!-- <div class="row pt-3">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">ACCEPTED RFM RATIO</div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered" width="100%" id="dt_dashboard">
                        <thead class="bg-primary text-light">
                            <tr>
                                <th>PROBLEM TYPE</th>
                                <th>JML PENDING</th>
                                <th>JML ACCEPTED</th>
                                <th>JML REJECTED</th>
                                <th>RASIO ACCEPTED</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach($chart_pie as $r): ?>
                            <tr>
                                <td style="text-align: left"><?php echo $r->problem_type ?></td>
                                <td style="text-align: right"><?php echo $r->jml_rfm_pending ?></td>
                                <td style="text-align: right"><?php echo $r->jml_rfm_accepted ?></td>
                                <td style="text-align: right"><?php echo $r->jml_rfm_reject ?></td>
                                <td style="text-align: right"><?php echo $r->rasio_rfm_accepted." %" ?></td>
                            </tr>
                            <?php endforeach ?>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td><b>JUMLAH</b></td>
                                <td></td>
                                <td style="text-align: right"><?php echo "<b>$total_semua</b>" ?></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div> -->

