<div class="card mb-3" style="margin-top: 15px">
    <div class="card-header" >
        <b>PROFILE DEPARTMENT IT</b>
    </div>

    <div class="card-body">
        <div class ="row justify-content-center">

            <div class="col-3 text-center">
                 <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Darwhin.png" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">DARWHIN SINARTA</h5>
                        <p class="card-text">DIREKSI</p>
                    </div>
                </div>
            </div>

            <div class="col-3 text-center">
                 <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Hamsudi.png" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">HAMSUDI</h5>
                        <p class="card-text">HEAD IT</p>
                    </div>
                </div>
            </div>

            <div class="col-3 text-center">
                 <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Indra.jpg" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">INDRA MAULANA</h5>
                        <p class="card-text">SUPERVISOR IT</p>
                    </div>
                </div>
            </div>

        </div>

        <div class ="row" style="margin-top: 30px">
            <div class="col-sm-3">
                <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Alan.png" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">ALAN GENTINA</h5>
                        <p class="card-text">IT Programmer</p>
                        <a href="<?php echo base_url('profile') ?>" class="btn btn-primary stretched-link">See Profile</a>
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                 <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Bonar.jpg" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">BONAR PURBA</h5>
                        <p class="card-text">IT Infrastructure Specialist</p>
                        <a href="<?php echo base_url('profile') ?>" class="btn btn-primary stretched-link">See Profile</a>
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                 <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Elvia.jpg" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">ELVIA NUR ANGGRAINI</h5>
                        <p class="card-text">IT Programmer</p>
                        <a href="<?php echo base_url('profile') ?>" class="btn btn-primary stretched-link">See Profile</a>
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                 <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Irvan.jpg" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">IRVAN MUHAMMAD SINDY</h5>
                        <p class="card-text">IT Programmer</p>
                        <a href="<?php echo base_url('profile') ?>" class="btn btn-primary stretched-link">See Profile</a>
                    </div>
                </div>
            </div>

        </div>

        <div class ="row" style="margin-top: 15px">
            <div class="col-sm-3">
                <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Nanang.png" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">NANANG ANDRIANI</h5>
                        <p class="card-text">IT Programmer</p>
                        <a href="<?php echo base_url('profile') ?>" class="btn btn-primary stretched-link">See Profile</a>
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                 <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Reynaldi.png" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">REYNALDI</h5>
                        <p class="card-text">IT Programmer</p>
                        <a href="<?php echo base_url('profile') ?>" class="btn btn-primary stretched-link">See Profile</a>
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                 <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Rudy.png" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">RUDY NOVRIANTO</h5>
                        <p class="card-text">IT Programmer</p>
                        <a href="<?php echo base_url('profile') ?>" class="btn btn-primary stretched-link">See Profile</a>
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                 <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Suluh.png" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">SULUH DAMAR GRAHITA</h5>
                        <p class="card-text">IT Programmer</p>
                        <a href="<?php echo base_url('profile') ?>" class="btn btn-primary stretched-link">See Profile</a>
                    </div>
                </div>
            </div>

        </div>

        <div class ="row" style="margin-top: 15px">
            <div class="col-sm-3">
                <div class="card text-center">
                    <img class="card-img-top" src="assets/img/Yosef.png" style="width:100%">
                    <div class="card-body">
                        <h5 class="card-title">YOSEP HERYANA</h5>
                        <p class="card-text">IT Programmer</p>
                        <a href="<?php echo base_url('profile') ?>" class="btn btn-primary stretched-link">See Profile</a>
                    </div>
                </div>
            </div>

        </div>

    </div>
</div>

<div class="card mb-3" id="table" style="margin-top: 15px">
    <div class="card-header" >
        <b>DAILY ACTIVITY DEPARTMENT IT</b>
    </div>
    <div class="card-body">
        <table class="colapse-table res3"  width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th style="text-align: center">#</th>
                    <th>HARI</th>
                    <th>TANGGAL</th>
					<th>WAKTU</th>
					<th>PROJECT</th>
					<th>TASK</th>
					<th>RFM</th>
                    <th>STATUS</th>
                    <th>KETERANGAN</th>
                    <th>PIC</th>
                </tr>
            </thead>
            <tbody>
                <?php 
                    $ITList = $this->db->get(TB_USER)->result();
                    $projectList = $this->db->get(TB_PROJECT)->result();
                    $taskList = $this->db->get(TB_TASK)->result();
                    $rfmList = $this->db->get(TB_DETAIL)->result();
                ?>

                <?php foreach($ITList as $r): ?>
                    
                    <?php 
                        $this->db->where('user_id', $r->user_id);
                        $this->db->where('date_activity', date('Y-m-d'));
                        $this->db->order_by('last_update DESC');
                        $specificDailyActivity = $this->db->get(TB_DAILY_ACTIVITY)->result();
                    ?>
                    
                    <?php if (count($specificDailyActivity) > 0) { ?>
                        <?php foreach($specificDailyActivity as $row): ?>
                            <?php if (array_search($row, $specificDailyActivity) == 0) {?>
                                <tr>
                                    <td style="text-align: center"><i data-toggle="collapse" data-target=<?php echo "#".$r->user_id?> style=" color: #28a745; background-color: #f4fbff" class="fa fa-plus-circle" aria-hidden="true"></i></td>
                                    <td>
                                        <?php
                                            $hari = date('l',strtotime($row->date_activity));
                                            switch($hari){
                                                case 'Sunday':
                                                    $hari = "Minggu";
                                                break;
                                        
                                                case 'Monday':			
                                                    $hari = "Senin";
                                                break;
                                        
                                                case 'Tuesday':
                                                    $hari = "Selasa";
                                                break;
                                        
                                                case 'Wednesday':
                                                    $hari = "Rabu";
                                                break;
                                        
                                                case 'Thursday':
                                                    $hari = "Kamis";
                                                break;
                                        
                                                case 'Friday':
                                                    $hari = "Jumat";
                                                break;
                                        
                                                case 'Saturday':
                                                    $hari = "Sabtu";
                                                break;
                                                
                                                default:
                                                    $hari= "Tidak di ketahui";		
                                                break;
                                            }
                                            echo $hari;
                                        ?>
                                    </td>
                                    <td><?php echo date("d-m-Y",strtotime( $row->date_activity)) ?></td>
                                    <td><?php echo date("H:i",strtotime( $row->last_update)) ?></td>
                                    <td>
                                        <?php 
                                            // $data = json_encode($projectList->result());
                                            // echo "<script>console.log($data);</script>";
                                            $tableDataProjectName = null;
                                            if (!empty($row->project_id))
                                            {
                                                foreach($projectList as $rowProject):
                                                    if ($row->project_id == $rowProject->id) {
                                                        $tableDataProjectName = $rowProject->project_name;
                                                        break;
                                                    }
                                                endforeach;
                                            }
                                            else {
                                                $tableDataProjectName = "-";
                                            }
                                            echo $tableDataProjectName;
                                        ?>
                                    </td>
                                    <td>
                                        <?php $tableTaskName = null;
                                            if (!empty($row->task_id))
                                            {
                                                foreach($taskList as $rowTask):
                                                    if ($row->task_id == $rowTask->id) {
                                                        $tableTaskName = $rowTask->task_name;
                                                        break;
                                                    }
                                                endforeach;
                                            }
                                            else {
                                                $tableTaskName = "-";
                                            }
                                            echo $tableTaskName;
                                        ?>
                                    </td>            
                                    <td>
                                        <?php $tableDataNoRFM = null;
                                            if (!empty($row->rfm_id))
                                            {
                                                foreach($rfmList as $rowRfm):
                                                    if ($row->rfm_id == $rowRfm->id) {
                                                        $tableDataNoRFM = $rowRfm->no_rfm;
                                                        break;
                                                    }
                                                endforeach;
                                            }
                                            else {
                                                $tableDataNoRFM = "-";
                                            }
                                            echo $tableDataNoRFM;
                                        ?>
                                    </td>
                                    <td><?php echo $row->status ?></td>
                                    <td><?php echo $row->keterangan ?></td>
                                    <td><?php echo $r->nama ?></td>
                                </tr>
                            <?php } ?>
                        <?php endforeach ?>
                        <tr id=<?php echo $r->user_id?> class="collapse">
                            <td colspan="10">
                                <p>
                                    <table style="width: 100%">
                                    <thead>
                                        <tr>
                                            <th>HARI</th>
                                            <th>TANGGAL</th>
                                            <th>WAKTU</th>
                                            <th>PROJECT</th>
                                            <th>TASK</th>
                                            <th>RFM</th>
                                            <th>STATUS</th>
                                            <th>KETERANGAN</th>
                                        </tr>
                                    </thead>
                                        <?php foreach($specificDailyActivity as $row): ?>
                                            <?php if (array_search($row, $specificDailyActivity) !== 0) {?>
                                                
                                                <tr>
                                                    <td>
                                                        <?php
                                                            $hari = date('l',strtotime($row->date_activity));
                                                            switch($hari){
                                                                case 'Sunday':
                                                                    $hari = "Minggu";
                                                                break;
                                                        
                                                                case 'Monday':			
                                                                    $hari = "Senin";
                                                                break;
                                                        
                                                                case 'Tuesday':
                                                                    $hari = "Selasa";
                                                                break;
                                                        
                                                                case 'Wednesday':
                                                                    $hari = "Rabu";
                                                                break;
                                                        
                                                                case 'Thursday':
                                                                    $hari = "Kamis";
                                                                break;
                                                        
                                                                case 'Friday':
                                                                    $hari = "Jumat";
                                                                break;
                                                        
                                                                case 'Saturday':
                                                                    $hari = "Sabtu";
                                                                break;
                                                                
                                                                default:
                                                                    $hari= "Tidak di ketahui";		
                                                                break;
                                                            }
                                                            echo $hari;
                                                        ?>
                                                    </td>
                                                    <td><?php echo date("d-m-Y",strtotime( $row->date_activity)) ?></td>
                                                    <td><?php echo date("H:i",strtotime( $row->last_update)) ?></td>
                                                    <td>
                                                        <?php 
                                                            // $data = json_encode($projectList->result());
                                                            // echo "<script>console.log($data);</script>";
                                                            $tableDataProjectName = null;
                                                            if (!empty($row->project_id))
                                                            {
                                                                foreach($projectList as $rowProject):
                                                                    if ($row->project_id == $rowProject->id) {
                                                                        $tableDataProjectName = $rowProject->project_name;
                                                                        break;
                                                                    }
                                                                endforeach;
                                                            }
                                                            else {
                                                                $tableDataProjectName = "-";
                                                            }
                                                            echo $tableDataProjectName;
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php $tableTaskName = null;
                                                            if (!empty($row->task_id))
                                                            {
                                                                foreach($taskList as $rowTask):
                                                                    if ($row->task_id == $rowTask->id) {
                                                                        $tableTaskName = $rowTask->task_name;
                                                                        break;
                                                                    }
                                                                endforeach;
                                                            }
                                                            else {
                                                                $tableTaskName = "-";
                                                            }
                                                            echo $tableTaskName;
                                                        ?>
                                                    </td>
                                                    
                                                    <td>
                                                        <?php $tableDataNoRFM = null;
                                                            if (!empty($row->rfm_id))
                                                            {   
                                                                foreach($rfmList as $rowRfm):
                                                                    if ($row->rfm_id == $rowRfm->id) {
                                                                        $tableDataNoRFM = $rowRfm->no_rfm;
                                                                        break;
                                                                    }
                                                                endforeach;
                                                            }
                                                            else {
                                                                $tableDataNoRFM = "-";
                                                            }
                                                            echo $tableDataNoRFM;
                                                        ?>
                                                    </td>
                                                    <td><?php echo $row->status ?></td>
                                                    <td><?php echo $row->keterangan ?></td>
                                                </tr>
                                            <?php } ?>
                                        <?php endforeach ?>
                                    </table>
                                </p>
                            </td>
                        </tr>
                    <?php } ?>
                <?php endforeach ?>
            </tbody>        
        </table>
    </div>
</div>

<div class="card mb-3" id="table" style="margin-top: 15px">
    <div class="card-header" >
        <b>PROGRESS PROJECT</b>
    </div>
    <div class="card-body">
    <!-- table table-bordered table-hover -->
        <table class="colapse-table res3"  width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th style="text-align: center">#</th>
                    <th>PROJECT</th>
                    <th>STATUS</th>
                    <th>PROGRESS</th>
                    <th>LAST UPDATE</th>
                </tr>
            </thead>

            <tbody>
                <?php foreach($filteredProjectList as $r): ?>
                    
                    <?php 
                        $this->db->where('project_id', $r->id);
                        $this->db->order_by('last_update DESC');
                        $specificTask = $this->db->get(TB_TASK)->result();

                        $this->db->where('project_id', $r->id);
                        $this->db->where('status', STT_DONE);
                        $this->db->order_by('last_update DESC');
                        $taskList_done = $this->db->get(TB_TASK)->result();

                        $progressValue = count($taskList_done)/count($specificTask) * 100;
                    ?>
                    
                    <tr>
                        <td style="text-align: center"><i data-toggle="collapse" data-target=<?php echo "#".$r->id?> style=" color: #28a745; background-color: #f4fbff" class="fa fa-plus-circle" aria-hidden="true"></i></td>
                        <td><?php echo $r->project_name?></td>
                        <td>
                            <?php
                                $progressStatus = null;
                                if (count($taskList_done) == count($specificTask)) {
                                    $progressStatus = STT_DONE;    
                                } else {
                                    $progressStatus = STT_ON_PROGRESS;
                                }
                                echo $progressStatus;
                            ?>
                        </td>
                            
                        <td>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" aria-valuenow="<?php echo $progressValue?>" aria-valuemin="0" aria-valuemax="100" style="width:<?php echo $progressValue?>%">
                                    <?php echo $progressValue?>%
                                </div>
                            </div>
                        </td>
                        <td><?php echo date("d-m-Y | H:i:s",strtotime( $r->last_update))?></td>
                    </tr>

                    <tr id=<?php echo $r->id?> class="collapse">                     
                        <td colspan="5">
                            <p>
                                <table style="width: 100%">
                                    <thead>
                                        <tr>
                                            <th>NAMA TASK</th>
                                            <th>TARGET DATE</th>
                                            <th>STATUS</th>
                                            <th>LAST UPDATE</th>
                                            <th>PIC</th>
                                            <th>KETERANGAN</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <?php foreach($specificTask as $row): ?>
                                            <tr>
                                                <td><?php echo $row->task_name?></td>
                                                <td><?php echo date("d-m-Y",strtotime( $row->target_date))?></td>
                                                <td><?php echo $row->status?></td>
                                                <td><?php echo date("d-m-Y | H:i:s",strtotime( $row->last_update))?></td>
                                                <td>
                                                    <?php 
                                                        $this->db->where('user_id', $row->assign_to);
                                                        echo $this->db->get(TB_USER)->row()->nama;
                                                    ?>
                                                </td>
                                                <td>
                                                    <?php 
                                                        if (date("d-m-Y",strtotime($row->last_update)) > date("d-m-Y",strtotime($row->target_date))) {
                                                            echo'Task telah melewati target date';
                                                        }
                                                    ?>
                                                </td>
                                            </tr>
                                        <?php endforeach ?>
                                    </tbody>
                                </table>
                            </p>
                        </td>
                    </tr>
                <?php endforeach ?>
            </tbody>

        </table>
    </div>
</div>

